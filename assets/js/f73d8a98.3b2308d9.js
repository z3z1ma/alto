"use strict";(self.webpackChunkalto_docs=self.webpackChunkalto_docs||[]).push([[270],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=o,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||i;return n?a.createElement(f,r(r({ref:t},c),{},{components:n})):a.createElement(f,r({ref:t},c))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:o,r[1]=l;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(6010);const i={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,o.Z)(i.tabItem,r),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(7462),o=n(7294),i=n(6010),r=n(2466),l=n(6550),s=n(1980),u=n(7392),c=n(12);function p(e){return function(e){return o.Children.map(e,(e=>{if((0,o.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:o}}=e;return{value:t,label:n,attributes:a,default:o}}))}function d(e){const{values:t,children:n}=e;return(0,o.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(i),(0,o.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(a.location.search);t.set(i,e),a.replace({...a.location,search:t.toString()})}),[i,a])]}function h(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,i=d(e),[r,l]=(0,o.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:i}))),[s,u]=f({queryString:n,groupId:a}),[p,h]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,i]=(0,c.Nk)(n);return[a,(0,o.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:a}),b=(()=>{const e=s??p;return m({value:e,tabValues:i})?e:null})();(0,o.useLayoutEffect)((()=>{b&&l(b)}),[b]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),h(e)}),[u,h,i]),tabValues:i}}var b=n(2389);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function k(e){let{className:t,block:n,selectedValue:l,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,r.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==l&&(p(t),s(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return o.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:r}=e;return o.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>c.push(e),onKeyDown:m,onClick:d},r,{className:(0,i.Z)("tabs__item",v.tabItem,r?.className,{"tabs__item--active":l===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:a}=e;if(n=Array.isArray(n)?n:[n],t){const e=n.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return o.createElement("div",{className:"margin-top--md"},n.map(((e,t)=>(0,o.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function g(e){const t=h(e);return o.createElement("div",{className:(0,i.Z)("tabs-container",v.tabList)},o.createElement(k,(0,a.Z)({},e,t)),o.createElement(y,(0,a.Z)({},e,t)))}function w(e){const t=(0,b.Z)();return o.createElement(g,(0,a.Z)({key:String(t)},e))}},8603:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>f,frontMatter:()=>l,metadata:()=>u,toc:()=>p});var a=n(7462),o=(n(7294),n(3905)),i=n(4866),r=n(5162);const l={},s="Project Configuration",u={unversionedId:"tutorial-basics/project-configuration",id:"tutorial-basics/project-configuration",title:"Project Configuration",description:"How is a project configured?",source:"@site/docs/tutorial-basics/project-configuration.mdx",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/project-configuration",permalink:"/alto/docs/tutorial-basics/project-configuration",draft:!1,editUrl:"https://github.com/z3z1ma/alto/tree/main/docs/docs/tutorial-basics/project-configuration.mdx",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Secret Management",permalink:"/alto/docs/tutorial-basics/secret-management"},next:{title:"Plugin Configuration",permalink:"/alto/docs/tutorial-basics/plugin-configuration"}},c={},p=[{value:"How is a project configured?",id:"how-is-a-project-configured",level:2},{value:"Example Project Configuration",id:"example-project-configuration",level:2},{value:"Settings",id:"settings",level:2},{value:"<code>project_name</code>",id:"project_name",level:3},{value:"<code>filesystem</code>",id:"filesystem",level:3},{value:"<code>bucket</code>",id:"bucket",level:3},{value:"<code>extensions</code>",id:"extensions",level:3},{value:"User-defined extensions",id:"user-defined-extensions",level:4},{value:"Built-in extensions",id:"built-in-extensions",level:4},{value:"<code>environment</code>",id:"environment",level:3},{value:"<code>filesystem_settings</code>",id:"filesystem_settings",level:3},{value:"Considerations",id:"considerations",level:2}],d={toc:p},m="wrapper";function f(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"project-configuration"},"Project Configuration"),(0,o.kt)("h2",{id:"how-is-a-project-configured"},"How is a project configured?"),(0,o.kt)("p",null,"There are two main units of configuration in ",(0,o.kt)("inlineCode",{parentName:"p"},"alto"),". There is ",(0,o.kt)("strong",{parentName:"p"},"project-level")," configuration and there is ",(0,o.kt)("strong",{parentName:"p"},"plugin-level")," configuration. Project level configuration consists of top level keys in the ",(0,o.kt)("inlineCode",{parentName:"p"},"alto.toml")," file. The project configuration supports general settings such as project name, filesystem, bucket, and so on. We will step through each of these now."),(0,o.kt)("h2",{id:"example-project-configuration"},"Example Project Configuration"),(0,o.kt)("p",null,"Here is an example of a project configuration file with all the knobs populated:"),(0,o.kt)("admonition",{title:"Tip",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Remember the top level key ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," is special. It is the default environment that serves as the baseline upon which other environments are layered. You can have as many environments as you want, but you must specify an environment via the ",(0,o.kt)("inlineCode",{parentName:"p"},"ALTO_ENV")," environment variable if you want to leverage them. This means all project-level config should ideally be under the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," key and can be overridden per-env as needed.")),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"toml",label:"TOML",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-toml",metastring:'title="alto.toml"',title:'"alto.toml"'},'[default]\nproject_name = "alto-project"\nfilesystem = "gcs"\nbucket = "my-bucket"\nextensions = [\n    "./path/to/extension.py",\n    "evidence",\n]\nenvironment.SOME_ENV_VAR = "some value"\nenvironment.ANOTHER_ENV_VAR = "another value"\nfilesystem_settings.project = "my-project"\nfilesystem_settings.token = "@format {env[GOOGLE_APPLICATION_CREDENTIALS]}"\n'))),(0,o.kt)(r.Z,{value:"yaml",label:"YAML",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="alto.yaml"',title:'"alto.yaml"'},'default:\n  project_name: alto-project\n  filesystem: gcs\n  bucket: my-bucket\n  extensions:\n    - ./path/to/extension.py\n    - evidence\n\n  environment:\n    SOME_ENV_VAR: some value\n    ANOTHER_ENV_VAR: another value\n\n  filesystem_settings:\n    project: my-project\n    token: "@format {env[GOOGLE_APPLICATION_CREDENTIALS]}"\n'))),(0,o.kt)(r.Z,{value:"json",label:"JSON",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="alto.json"',title:'"alto.json"'},'{\n  "default": {\n    "project_name": "alto-project",\n    "filesystem": "gcs",\n    "bucket": "my-bucket",\n    "extensions": [\n      "./path/to/extension.py",\n      "evidence"\n    ],\n    "environment": {\n      "SOME_ENV_VAR": "some value",\n      "ANOTHER_ENV_VAR": "another value"\n    },\n    "filesystem_settings": {\n      "project": "my-project",\n      "token": "@format {env[GOOGLE_APPLICATION_CREDENTIALS]}"\n    }\n  }\n}\n')))),(0,o.kt)("h2",{id:"settings"},"Settings"),(0,o.kt)("h3",{id:"project_name"},(0,o.kt)("inlineCode",{parentName:"h3"},"project_name")),(0,o.kt)("p",null,"The name of the project. This is used to determine the subdirectory in the remote filesystem where the project will be stored. This allows multiple projects to be stored in the same bucket while also ensuring the same project name + bucket to be equivalent across machines. This was inspired by ",(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/"},"terraform"),". Changing this value will cause alto to treat the project as a new project and will not be able to find any existing data including cached PEX files, catalogs, and state."),(0,o.kt)("h3",{id:"filesystem"},(0,o.kt)("inlineCode",{parentName:"h3"},"filesystem")),(0,o.kt)("p",null,"The filesystem to use. This can be one of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"gcs"),"     - Google Cloud Storage"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"s3"),"      - Amazon S3"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"azdl"),"    - Azure Data Lake"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"file"),"    - Local filesystem (default)")),(0,o.kt)("p",null,"The filesystem support is driven entirely by ",(0,o.kt)("a",{parentName:"p",href:"https://filesystem-spec.readthedocs.io/en/latest/"},"fsspec"),"."),(0,o.kt)("p",null,"The default filesystem is ",(0,o.kt)("inlineCode",{parentName:"p"},"file"),". This is useful for testing and development. It will store data in the ",(0,o.kt)("inlineCode",{parentName:"p"},"~/.alto/{project}/")," directory on the local machine."),(0,o.kt)("p",null,"Once it is time to move beyond your machine and potentially out to a team of devs, it is ",(0,o.kt)("strong",{parentName:"p"},"highly")," recommended to use a remote filesystem by ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," across ",(0,o.kt)("em",{parentName:"p"},"all")," configured environments. The remote filesystem utilization in ",(0,o.kt)("inlineCode",{parentName:"p"},"alto")," will already ",(0,o.kt)("strong",{parentName:"p"},"isolate data by project name and environment"),". This means you do not need ",(0,o.kt)("inlineCode",{parentName:"p"},"file")," for development and ",(0,o.kt)("inlineCode",{parentName:"p"},"gcs")," for production. You can use the same filesystem across all environments and the data will be isolated. This allows you to have the remote filesystem be the source of truth for all environments. This is especially useful for CI/CD environments where you want to be able to run alto commands in a clean environment without having to worry about the state of the local filesystem. It draws on prior art from the DX (developer experience) of ",(0,o.kt)("a",{parentName:"p",href:"https://www.terraform.io/"},"terraform")," and ",(0,o.kt)("a",{parentName:"p",href:"https://www.pulumi.com/"},"pulumi"),"."),(0,o.kt)("h3",{id:"bucket"},(0,o.kt)("inlineCode",{parentName:"h3"},"bucket")),(0,o.kt)("p",null,"The bucket to use. This is the name of the bucket to use. This is only used if the ",(0,o.kt)("inlineCode",{parentName:"p"},"filesystem")," is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"gcs"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"s3"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"azdl"),". If the ",(0,o.kt)("inlineCode",{parentName:"p"},"filesystem")," is set to ",(0,o.kt)("inlineCode",{parentName:"p"},"file"),", this value is ignored."),(0,o.kt)("h3",{id:"extensions"},(0,o.kt)("inlineCode",{parentName:"h3"},"extensions")),(0,o.kt)("p",null,"Extensions consist of 2 varieties. There are built-in extensions and there are user-defined extensions. Built-in extensions are included with ",(0,o.kt)("inlineCode",{parentName:"p"},"alto")," and are always available. User-defined extensions are defined by the user and can be used to extend alto with custom commands and functionality. The ",(0,o.kt)("inlineCode",{parentName:"p"},"extensions")," key should be composed of a list of these 2 variants."),(0,o.kt)("h4",{id:"user-defined-extensions"},"User-defined extensions"),(0,o.kt)("p",null,"A user-defined extension is specified via a path to a python file relative to the ",(0,o.kt)("inlineCode",{parentName:"p"},"alto.toml"),". These extensions will be loaded when ",(0,o.kt)("inlineCode",{parentName:"p"},"alto")," is run. This allows you to extend alto with your ",(0,o.kt)("em",{parentName:"p"},"own")," custom commands and functionality. All extensions must be python files. Alto will look for the ",(0,o.kt)("inlineCode",{parentName:"p"},"register")," function in each file and call it. This function should return a subclass of ",(0,o.kt)("inlineCode",{parentName:"p"},"alto.engine.AltoExtension"),". Alto will register any commands that are defined in the extension via the ",(0,o.kt)("inlineCode",{parentName:"p"},"tasks")," method. Tasks are ",(0,o.kt)("a",{parentName:"p",href:"https://pydoit.org/"},"doit")," tasks. You can read more about doit tasks ",(0,o.kt)("a",{parentName:"p",href:"https://pydoit.org/tasks.html"},"here"),". We include a helper class which allows you to use a builder pattern to define tasks."),(0,o.kt)("h4",{id:"built-in-extensions"},"Built-in extensions"),(0,o.kt)("p",null,"A built-in extension can be enabled by adding the extension name to the ",(0,o.kt)("inlineCode",{parentName:"p"},"extensions")," list. For example, to enable the ",(0,o.kt)("inlineCode",{parentName:"p"},"evidence")," extension, you would simply add ",(0,o.kt)("inlineCode",{parentName:"p"},"evidence")," to the ",(0,o.kt)("inlineCode",{parentName:"p"},"extensions")," list."),(0,o.kt)("p",null,"The following extensions are built-in to ",(0,o.kt)("inlineCode",{parentName:"p"},"alto"),":"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"evidence")," - This extension allows you to run ",(0,o.kt)("a",{parentName:"li",href:"https://evidence.dev/"},"Evidence.dev")," tasks."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"dbt")," - This extension allows you to run recipes of ",(0,o.kt)("a",{parentName:"li",href:"https://www.getdbt.com/"},"dbt")," tasks. (Coming soon)")),(0,o.kt)("p",null,"Built-in extensions are not intended to replace any package but rather augment them with additional generic conveniences that would expedite the workflow for a majority of users. User-defined extensions on the other hand, can be much more specific."),(0,o.kt)("h3",{id:"environment"},(0,o.kt)("inlineCode",{parentName:"h3"},"environment")),(0,o.kt)("p",null,"Key value pairs to inject into the environment. These environment variables will be available to all tasks. This is useful for setting environment variables that are used by multiple tasks or utilities."),(0,o.kt)("h3",{id:"filesystem_settings"},(0,o.kt)("inlineCode",{parentName:"h3"},"filesystem_settings")),(0,o.kt)("p",null,"The filesystem settings to use. This is a dictionary of settings to use for the filesystem. These settings will be passed to the ",(0,o.kt)("a",{parentName:"p",href:"https://filesystem-spec.readthedocs.io/en/latest/"},"fspsec")," filesystem. This gives the user the ability to configure the filesystem as they see fit."),(0,o.kt)("h2",{id:"considerations"},"Considerations"),(0,o.kt)("p",null,"In the example above, we used the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," environment exclusively. You can imagine how these layers can be used to further customize the configuration. It is worth noting though, in my experience, project level configuration is best set in the ",(0,o.kt)("inlineCode",{parentName:"p"},"default")," environment with the exception of the ",(0,o.kt)("inlineCode",{parentName:"p"},"environment")," key. It is strongly advised that one project uses one remote storage to reap maximum benefits. A reasonable exception would be routing to another project / bucket for more secure storage of sensitive data in specific environments."))}f.isMDXComponent=!0}}]);